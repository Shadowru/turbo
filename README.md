# BFT Semantic Analyzer (MVP)

–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –±–∏–∑–Ω–µ—Å-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (–ë–§–¢) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RAG-–ø–æ–¥—Ö–æ–¥–∞ –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö/–æ–±–ª–∞—á–Ω—ã—Ö LLM. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç:

- Solution Architecture-–∞–Ω–∞–ª–∏–∑ –ë–§–¢
- –°–ø–∏—Å–æ–∫ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö/–Ω–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
- UML-–¥–∏–∞–≥—Ä–∞–º–º—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π (Mermaid)
- –ü–µ—Ä–µ—á–µ–Ω—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö/–Ω–æ–≤—ã—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–æ–ø–∏–∫–æ–≤

---

## ‚ú® –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **RAG –ø–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–º—É –∫–∞—Ç–∞–ª–æ–≥—É**: ChromaDB + SQLite –∫–∞–∫ —Ä–µ–µ—Å—Ç—Ä —Å–∏—Å—Ç–µ–º.
- **LLM-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Ollama (–ª–æ–∫–∞–ª—å–Ω–æ) –∏ OpenAI API.
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥**: —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON + Mermaid-–¥–∏–∞–≥—Ä–∞–º–º—ã (sequence, flowchart).
- **API-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ—Å—Ç—å**: FastAPI —Å REST endpoint.
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ UI.

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (High Level)

```mermaid
flowchart LR
    subgraph API Layer
        FastAPI
    end

    subgraph Core
        Orchestrator
        Pipeline
        Outputs
    end

    subgraph Storage
        SQLite[(SQLite)]
        Chroma[(ChromaDB)]
    end

    subgraph LLM
        Ollama[(Ollama Model)]
        OpenAI[(OpenAI API)]
    end

    FastAPI --> Orchestrator
    Orchestrator --> Pipeline
    Pipeline --> Outputs
    Orchestrator --> SQLite
    Orchestrator --> Chroma
    Pipeline --> LLM
    LLM --> Pipeline
```

## üîÅ –ü–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞

```mermaid
sequenceDiagram
    participant User as –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä
    participant API as FastAPI
    participant Orchestrator
    participant Preproc
    participant RAG as ChromaDB
    participant LLM
    participant Outputs

    User->>API: POST /api/v1/analyze (BFT)
    API->>Orchestrator: process_bft()
    Orchestrator->>Preproc: clean + chunk
    Preproc->>RAG: upsertChunks()
    Orchestrator->>RAG: retrieve(top-k)
    Orchestrator->>LLM: run_architecture_chain()
    LLM-->>Orchestrator: JSON-–æ—Ç–≤–µ—Ç
    Orchestrator->>Outputs: build_outputs()
    Outputs-->>Orchestrator: Mermaid –¥–∏–∞–≥—Ä–∞–º–º—ã
    Orchestrator-->>API: structured answer
    API-->>User: JSON + UML (Mermaid)
```
### üîé Retrieval (BM25 + –≤–µ–∫—Ç–æ—Ä–Ω—ã–π)

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `HybridRetrievalManager`: —Å–æ—á–µ—Ç–∞–Ω–∏–µ `BM25Retriever` (rank-bm25) –∏ `Chroma` –Ω–∞ sentence-transformers `all-MiniLM-L6-v2`.
- –†–µ–≥–∏—Å—Ç—Ä —Å–∏—Å—Ç–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ RAG-–∫–æ–Ω—Ç–µ–∫—Å—Ç.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
  - `embedding_model_name` ‚Äî –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤
  - `bm25_index_path` ‚Äî JSON —Å –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è BM25
  - `retrieval_top_k` ‚Äî —á–∏—Å–ª–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ


–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–ø–æ–ª–Ω—è—Ç—å –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π RAG –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:

1. **–ß–µ—Ä–µ–∑ UI**

   - –ü–∞–Ω–µ–ª—å ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –≤ RAG¬ª.
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ `Doc ID`, `Source`, —Ç–µ–∫—Å—Ç –∏ (–ø–æ –∂–µ–ª–∞–Ω–∏—é) `Metadata JSON`.
   - –ù–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ RAG¬ª ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç —Ä–∞–∑–æ–±—å—ë—Ç—Å—è –Ω–∞ —á–∞–Ω–∫–∏, –ø–æ–ø–∞–¥—ë—Ç –≤ –≥–∏–±—Ä–∏–¥–Ω—ã–π –∏–Ω–¥–µ–∫—Å (BM25 + –≤–µ–∫—Ç–æ—Ä–Ω—ã–π Chroma).

2. **–ß–µ—Ä–µ–∑ API**

   ```bash
   curl -X POST http://localhost:8000/api/v1/rag/documents \
     -H "Content-Type: application/json" \
     -d '{
       "doc_id": "customer-profile-pl",
       "source": "wiki",
       "text": "–î–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ –ø—Ä–æ—Ñ–∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤...",
       "metadata": {"owner": "team-platform", "tags": ["customer", "profile"]}
     }'


### üñ•Ô∏è –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ –ë–§–¢** —Ç–µ–ø–µ—Ä—å —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞ –≤–∫–ª–∞–¥–∫–∏:
- –ê—Ä—Ö–∏¬≠—Ç–µ–∫¬≠—Ç—É—Ä¬≠–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ –∏ —Ç–∞–±–ª–∏—Ü—ã)
- –ó–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã (—Ç–∞–±–ª–∏—Ü–∞)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–æ–ø–∏–∫–∏ (—Ç–∞–±–ª–∏—Ü–∞)
- UML-–¥–∏–∞–≥—Ä–∞–º–º—ã (Mermaid)
- –°—ã—Ä–æ–π JSON

–ö–∞–∂–¥—É—é –≤–∫–ª–∞–¥–∫—É –º–æ–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å –≤ PDF (–∫–Ω–æ–ø–∫–∞ ¬´–°–∫–∞—á–∞—Ç—å PDF¬ª). –î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `html2canvas` + `jsPDF` (—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ `npm install jspdf html2canvas`).

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ RAG¬ª** ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ –∑–Ω–∞–Ω–∏–π –∏ –∏—Å—Ç–æ—Ä–∏—è.

### üßæ –ò—Å—Ç–æ—Ä–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤

- –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ë–§–¢ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SQLite (`bft_analysis_history`).
- REST‚Äë—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:
  - `GET /api/v1/history?limit=20` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø–∏—Å–µ–π.
  - `GET /api/v1/history/latest` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–π –∞–Ω–∞–ª–∏–∑ (–¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).
  - `GET /api/v1/history/{id}` ‚Äî –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä.
- UI: –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ ¬´–ê–Ω–∞–ª–∏–∑ –ë–§–¢¬ª —Å–ø—Ä–∞–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è. –ö–ª–∏–∫ –ø–æ –∑–∞–ø–∏—Å–∏ ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ—Ä–º—É.